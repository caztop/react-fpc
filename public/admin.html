<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    h1 { color: #333; }
    .post {
      border-bottom: 1px solid #ccc;
      margin-bottom: 15px;
      padding-bottom: 10px;
      background-color: #fff;
      padding: 10px;
      border-radius: 5px;
    }
    .post strong {
      font-size: 1.1em;
      color: #007acc;
    }
    .post small {
      color: #666;
      font-size: 0.9em;
    }
    .editable-content, strong[contenteditable="true"] {
      display: block;
      margin: 5px 0;
      padding: 5px;
      border: 1px dashed #ccc;
      border-radius: 3px;
      background-color: #fefefe;
    }
    button { margin-right: 5px; }
  </style>
</head>
<body>
  <h1>ğŸ” ê´€ë¦¬ì ê²Œì‹œíŒ</h1>
  <div id="loginSection">
    <h2>ë¡œê·¸ì¸</h2>
    <form id="loginForm">
      <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
      <button type="submit">ë¡œê·¸ì¸</button>
    </form>
  </div>

  <div style="margin: 10px 0;">
    <input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
    <button onclick="applyFilter()">ê²€ìƒ‰</button>
    <button onclick="toggleSort()">ì •ë ¬: <span id="sortLabel">ìµœì‹ ìˆœ</span></button>
  </div>

  <div id="posts" style="display: none;">ë¡œë”© ì¤‘...</div>
  <button id="logoutBtn" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
  <button id="downloadBtn" style="display: none;">ë¬¸ì˜ê¸€ ë‹¤ìš´ë¡œë“œ</button>

  <script>
    const API_BASE = 'https://react-fpc.onrender.com';

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const password = document.getElementById('password').value;

      try {
        const res = await fetch(`${API_BASE}/admin-login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ password })
        });

        const result = await res.json();

        if (res.ok && result.success) {
          document.getElementById('loginSection').style.display = 'none';
          document.getElementById('posts').style.display = 'block';
          document.getElementById('logoutBtn').style.display = 'block';
          document.getElementById('downloadBtn').style.display = 'block';
          loadPosts(); // admin.jsì— ì •ì˜ë¨
        } else {
          alert(result.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
        }
      } catch (err) {
        alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    document.getElementById('downloadBtn').addEventListener('click', async function () {
      try {
        const res = await fetch(`${API_BASE}/api/posts`, { credentials: 'include' });
        if (!res.ok) throw new Error('ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨');
        const data = await res.json();

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'posts.json';
        a.click();
        URL.revokeObjectURL(url);
      } catch (err) {
        alert('ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', async function () {
      try {
        const res = await fetch(`${API_BASE}/admin-logout`, {
          method: 'POST',
          credentials: 'include'
        });

        if (res.ok) {
          alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
          location.reload();
        } else {
          alert('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨');
        }
      } catch (err) {
        alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });
  </script>
  <script src="admin.js"></script>
</body>
</html>
